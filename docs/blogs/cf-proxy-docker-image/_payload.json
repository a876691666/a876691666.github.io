[{"data":1,"prerenderedAt":304},["ShallowReactive",2],{"blog-post-/blogs/cf-proxy-docker-image":3},{"id":4,"title":5,"body":6,"description":290,"extension":291,"meta":292,"navigation":299,"ogImage":294,"path":300,"seo":301,"stem":302,"__hash__":303},"content/blogs/cf-proxy-docker-image.md","使用 Cloudflare Workers 搭建 Docker 镜像代理",{"type":7,"value":8,"toc":285},"minimark",[9,13,17,35,41,44,58,61,64,67,72,83,89,92,121,124,128,142,145,148,152,155,158,161,164,184,187,211,215,222,281],[10,11,12],"h3",{"id":12},"背景",[14,15,16],"p",{},"目前国内 docker 加速源逐渐用不了了。就想着自己搭一个镜像中转的节点。",[14,18,19,20,30,31,34],{},"这里使用 ",[21,22,26],"a",{"href":23,"rel":24},"https://singee.atlassian.net/wiki/spaces/MAIN/pages/5079084/Cloudflare+Workers+Docker",[25],"nofollow",[27,28,29],"code",{},"hammal"," 的方案，通过 ",[27,32,33],{},"Cloudflare Workers"," 搭建。",[14,36,37],{},[21,38,40],{"href":23,"rel":39},[25],"hammal官方教程",[10,42,43],{"id":43},"前提",[45,46,47,55],"ul",{},[48,49,50,51,54],"li",{},"网络环境能正常访问",[27,52,53],{},"cloudflare","。",[48,56,57],{},"有自己的域名。",[10,59,60],{"id":60},"安装方法",[14,62,63],{},"这里截取官方教程的部分。",[65,66],"hr",{},[68,69,71],"h4",{"id":70},"fork-clone","Fork & Clone",[14,73,74,75,82],{},"首先 fork 仓库 ",[21,76,79],{"href":77,"rel":78},"https://github.com/ImSingee/hammal",[25],[27,80,81],{},"GitHub - ImSingee/hammal: docker-registry proxy run in cloudflare workers"," ，并克隆到本地",[84,85,86],"blockquote",{},[14,87,88],{},"可以的话顺便给个 Star😂",[14,90,91],{},"使用 pnpm install 安装依赖。没有的话使用 npm 安装 pnpm。",[93,94,99],"pre",{"className":95,"code":96,"language":97,"meta":98,"style":98},"language-bash shiki shiki-themes dracula","npm install -g pnpm\n","bash","",[27,100,101],{"__ignoreMap":98},[102,103,106,110,114,118],"span",{"class":104,"line":105},"line",1,[102,107,109],{"class":108},"sAOxA","npm",[102,111,113],{"class":112},"s-mGx"," install",[102,115,117],{"class":116},"sIQBb"," -g",[102,119,120],{"class":112}," pnpm\n",[14,122,123],{},"其实这里不确定npm和pnpm对项目包安装有什么影响，能用pnpm尽量用pnpm。",[68,125,127],{"id":126},"创建-workers-项目","创建 Workers 项目",[14,129,130,131,134,135,134,138,141],{},"进入 ",[27,132,133],{},"Cloudflare Dashboard"," -> ",[27,136,137],{},"Workers 和 Pages",[27,139,140],{},"概述"," 创建一个新的 Workers 项目，给他一个命名（例如 hammal）",[14,143,144],{},"在代码中复制 wrangler.toml.sample 文件, 改名 wrangler.toml 并修改其 name 和 account_id",[14,146,147],{},"name: 创建的 Worders 项目名\naccount_id: 可以通过 npx wrangler whoami 获得，也可以在 Workers 概述页面右侧的账户ID处复制。",[68,149,151],{"id":150},"创建-cache-缓存-kv","创建 cache 缓存 kv",[14,153,154],{},"在克隆好的项目目录下执行 npx wrangler kv:namespace create hammal_cache 来创建缓存 kv，记录下来输出的 id，填写到 wrangler.toml 文件中",[68,156,157],{"id":157},"部署",[14,159,160],{},"在克隆好的项目目录下执行 pnpm run deploy 来部署项目",[68,162,163],{"id":163},"域名",[14,165,166,167,170,171,134,174,134,177,134,180,183],{},"有域名则需要把域名的 ",[27,168,169],{},"名称服务器(name server)"," 改到 cloudflare 上，可以在 ",[27,172,173],{},"网站",[27,175,176],{},"添加的域名",[27,178,179],{},"DNS",[27,181,182],{},"记录"," 页面下获取。",[14,185,186],{},"设置后一般等待24小时即可在 cloudflare 上控制域名解析。",[14,188,189,190,134,192,134,195,134,198,134,201,134,204,207,208,54],{},"可以解析后前往 ",[27,191,137],{},[27,193,194],{},"用来获取docker的Workder",[27,196,197],{},"设置",[27,199,200],{},"触发器",[27,202,203],{},"自定义域",[27,205,206],{},"添加自定义域","。直接输入完整访问域名即可。例如",[27,209,210],{},"mirror.docker.xxx.com",[68,212,214],{"id":213},"本地docker设置","本地Docker设置",[14,216,217,218,221],{},"使用自定义的域名设置 ",[27,219,220],{},"deamon.json","。通常在 /etc/docker/daemon.json 。",[93,223,225],{"className":95,"code":224,"language":97,"meta":98,"style":98},"sudo tee /etc/docker/daemon.json \u003C\u003CEOF\n{\n  \"registry-mirrors\": [\n    \"https://mirror.docker.xxx.com\"\n  ]\n}\nEOF\n",[27,226,227,246,252,258,264,270,276],{"__ignoreMap":98},[102,228,229,232,235,238,242],{"class":104,"line":105},[102,230,231],{"class":108},"sudo",[102,233,234],{"class":112}," tee",[102,236,237],{"class":112}," /etc/docker/daemon.json",[102,239,241],{"class":240},"s0Tla"," \u003C\u003C",[102,243,245],{"class":244},"sCdxs","EOF\n",[102,247,249],{"class":104,"line":248},2,[102,250,251],{"class":112},"{\n",[102,253,255],{"class":104,"line":254},3,[102,256,257],{"class":112},"  \"registry-mirrors\": [\n",[102,259,261],{"class":104,"line":260},4,[102,262,263],{"class":112},"    \"https://mirror.docker.xxx.com\"\n",[102,265,267],{"class":104,"line":266},5,[102,268,269],{"class":112},"  ]\n",[102,271,273],{"class":104,"line":272},6,[102,274,275],{"class":112},"}\n",[102,277,279],{"class":104,"line":278},7,[102,280,245],{"class":244},[282,283,284],"style",{},"html pre.shiki code .sAOxA, html code.shiki .sAOxA{--shiki-default:#50FA7B}html pre.shiki code .s-mGx, html code.shiki .s-mGx{--shiki-default:#F1FA8C}html pre.shiki code .sIQBb, html code.shiki .sIQBb{--shiki-default:#BD93F9}html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html pre.shiki code .s0Tla, html code.shiki .s0Tla{--shiki-default:#FF79C6}html pre.shiki code .sCdxs, html code.shiki .sCdxs{--shiki-default:#F8F8F2}",{"title":98,"searchDepth":248,"depth":248,"links":286},[287,288,289],{"id":12,"depth":254,"text":12},{"id":43,"depth":254,"text":43},{"id":60,"depth":254,"text":60},"通过 Cloudflare Workers 搭建自己的 Docker 镜像中转节点，解决国内 Docker 加速源不可用的问题","md",{"date":293,"image":294,"alt":5,"tags":295,"published":299},"2023-08-01","/blogs-img/blog4.jpg",[296,53,297,298],"docker","proxy","workers",true,"/blogs/cf-proxy-docker-image",{"title":5,"description":290},"blogs/cf-proxy-docker-image","uvjF0i1HNicuC3sFZZAA8mwBpx30uBVk4OlIvYCQr_k",1751196002982]